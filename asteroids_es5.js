var _extends=Object.assign||function(a){for(var c,b=1;b<arguments.length;b++)for(var d in c=arguments[b],c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d]);return a};function easeOutBack(a,b){return void 0==b&&(b=1.70158),--a*a*((b+1)*a+b)+1}class GameObject{constructor(a){this.game=a,a.add(this)}destroy(){this.game.remove(this)}get BBox(){return null}contains(a){if(null===this.BBox)return!1;let{x:b,y:c}=a;return b>=this.BBox.x&&c>=this.BBox.y&&b<=this.BBox.x+this.BBox.width&&c<=this.BBox.y+this.BBox.height}collides(a){return a.contains({x:this.BBox.x+this.BBox.width/2,y:this.BBox.y})||a.contains({x:this.BBox.x+this.BBox.width/2,y:this.BBox.y+this.BBox.height})?"y":a.contains({x:this.BBox.x,y:this.BBox.y})&&a.contains({x:this.BBox.x,y:this.BBox.y+this.BBox.height})||a.contains({x:this.BBox.x+this.BBox.width,y:this.BBox.y})&&a.contains({x:this.BBox.x+this.BBox.width,y:this.BBox.y+this.BBox.height})?"x":a.contains({x:this.BBox.x,y:this.BBox.y})||a.contains({x:this.BBox.x+this.BBox.width,y:this.BBox.y})||a.contains({x:this.BBox.x,y:this.BBox.y+this.BBox.height})||a.contains({x:this.BBox.x+this.BBox.width,y:this.BBox.y+this.BBox.height})?"y":null}sphereCol(a){let b=(this.pos.x-a.pos.x)*(this.pos.x-a.pos.x)+(this.pos.y-a.pos.y)*(this.pos.y-a.pos.y);return b<(this.radius+a.radius)*(this.radius+a.radius)}get hovering(){return this.contains(this.game.mousePos)}click(){}update(){}}class Particle extends GameObject{constructor(a,b,c,d={x:0,y:0},e="#fff",f=3,g=800,h=5){super(a),this.pos=Object.assign({},b),this.speed=Object.assign({},c),this.acc=d,this.color=e,this.width=f,this.lifetime=g,this.trailLen=h,this.trail=[_extends({},b)],this.startTime=+new Date}update(a,b){let c=(+new Date-this.startTime)/this.lifetime;if(1<c)return this.destroy();this.speed.x+=this.acc.x,this.speed.y+=this.acc.y,this.pos.x+=this.speed.x*(1-c)*b/100,this.pos.y+=this.speed.y*(1-c)*b/100,this.trail.unshift(Object.assign({},this.pos)),this.trail=this.trail.splice(0,this.trailLen),a.strokeStyle=this.color,a.lineWidth=this.width;for(let d=1;d<this.trail.length;d++)a.globalAlpha=(this.trailLen-d)/this.trailLen*(1-c),a.beginPath(),a.moveTo(this.trail[d-1].x,this.trail[d-1].y),a.lineTo(this.trail[d].x,this.trail[d].y),a.stroke()}}class Asteroid extends GameObject{constructor(a,b=null){super(a),this.pos={x:this.game.canvas.width*Math.random(),y:this.game.canvas.height*Math.random()},this.rot=0,this.rotSpeed=(Math.random()-0.5)/100,this.radius=null===b?70*Math.random()+50:b,this.speed={x:30*(Math.random()-0.5)*(100/this.radius),y:30*(Math.random()-0.5)*(100/this.radius)},this.polygon=[];for(var c=0;20>c;c++)this.polygon.push({x:Math.sin(2*Math.PI*(c/20))*this.radius*(0.25*Math.random()+0.9),y:Math.cos(2*Math.PI*(c/20))*this.radius*(0.25*Math.random()+0.9)});this.sound=new Audio("explosion.wav"),this.sound.volume=0.2}get normSpeed(){let a=Math.hypot(this.speed.x,this.speed.y);return{x:this.speed.x/a,y:this.speed.y/a}}moveApart(a){for(;this.sphereCol(a);)this.pos.x+=this.speed.x/5,this.pos.y+=this.speed.y/5,a.pos.x+=a.speed.x/5,a.pos.y+=a.speed.y/5}destroy(){super.destroy(),this.game.score+=Math.round(this.radius),this.game.asteroids.splice(this.game.asteroids.indexOf(this),1),this.game.shake(50);for(var a=0;a<this.radius;a++){let b={x:this.pos.x+2*((Math.random()-0.5)*this.radius),y:this.pos.y+2*((Math.random()-0.5)*this.radius)},c={x:this.speed.x+200*(Math.random()-0.5),y:this.speed.y+200*(Math.random()-0.5)};new Particle(this.game,b,c,{x:5*(Math.random()-0.5),y:5*(Math.random()-0.5)},"hsl("+(1.7*this.radius+200)+", 100%, 55%)",5,1e3,20)}if(50<this.radius){let b=new Asteroid(this.game,this.radius*(Math.random()/3+0.33));b.pos={x:this.pos.x,y:this.pos.y};let c=new Asteroid(this.game,this.radius-b.radius);c.pos={x:this.pos.x,y:this.pos.y},c.speed={x:-b.speed.x,y:-b.speed.y},this.game.asteroids.push(b),this.game.asteroids.push(c),b.moveApart(c)}0===this.game.asteroids.length&&(this.game.ship.death_start=+new Date,this.game.ship.win_sound.play()),this.sound.play()}update(a,b){this.pos.x+=this.speed.x*b/100,this.pos.y+=this.speed.y*b/100,this.pos.x=(this.game.canvas.width+3*this.radius+this.pos.x)%(this.game.canvas.width+2*this.radius)-this.radius,this.pos.y=(this.game.canvas.height+3*this.radius+this.pos.y)%(this.game.canvas.height+2*this.radius)-this.radius,this.rot+=this.rotSpeed;for(let c of this.game.asteroids)if(c!==this&&this.sphereCol(c)){let r=this.speed,u=c.speed,v=this.pos,w=c.pos,z=this.radius*this.radius,A=c.radius*c.radius,B=(v.x-w.x)*(v.x-w.x)+(v.y-w.y)*(v.y-w.y),C=(r.x-u.x)*(v.x-w.x)+(r.y-u.y)*(v.y-w.y),D={x:r.x-2*A/(z+A)*(C/B)*(v.x-w.x),y:r.y-2*A/(z+A)*(C/B)*(v.y-w.y)},E=(u.x-r.x)*(w.x-v.x)+(u.y-r.y)*(w.y-v.y),F={x:u.x-2*z/(z+A)*(E/B)*(w.x-v.x),y:u.y-2*z/(z+A)*(E/B)*(w.y-v.y)};this.speed=D,c.speed=F,this.moveApart(c);break}a.fillStyle="hsl("+(1.7*this.radius+200)+", 100%, 45%)",a.strokeStyle="hsl("+(1.7*this.radius+200)+", 100%, 70%)",a.shadowColor="hsl("+(1.7*this.radius+200)+", 100%, 70%)",a.lineCap="round",a.shadowBlur=100,a.lineWidth=7,a.translate(this.pos.x,this.pos.y),a.rotate(this.rot),a.beginPath(),a.moveTo(this.polygon[0].x,this.polygon[0].y);for(let c of this.polygon)a.lineTo(c.x,c.y);a.lineTo(this.polygon[0].x,this.polygon[0].y),a.fill(),a.stroke()}}class Laser extends GameObject{constructor(a,b,c,d){super(a),this.pos=Object.assign({},b),this.speed=Object.assign({},c),this.rot=d,this.radius=10}update(a,b){this.pos.x+=this.speed.x*b/100,this.pos.y+=this.speed.y*b/100,(-10>this.pos.x||this.pos.x>this.game.canvas.width+10||-10>this.pos.y||this.pos.y>this.game.canvas.height+10)&&this.destroy(),0.2>Math.random()&&new Particle(this.game,this.pos,{x:-this.speed.x/10,y:-this.speed.y/10},{x:5*(Math.random()-0.5),y:5*(Math.random()-0.5)});for(let c of this.game.asteroids)if(this.sphereCol(c)){c.destroy(),this.destroy();break}a.strokeStyle="#fff",a.shadowColor="rgb(255,255,255)",a.shadowBlur=100,a.lineWidth=10,a.lineCap="round",a.beginPath(),a.moveTo(this.pos.x,this.pos.y),a.lineTo(this.pos.x-30*-Math.sin(this.rot),this.pos.y-30*Math.cos(this.rot)),a.stroke()}}class Ship extends GameObject{constructor(a){super(a),this.pos={x:this.game.canvas.width/2,y:this.game.canvas.height/2},this.speed={x:0,y:0},this.rot=Math.PI,this.cooldown=0,this.warpCooldown=0,this.radius=30,this.shield=3e3,this.death_start=-1,this.laser_sound=new Audio("laser.wav"),this.laser_sound.volume=0.3,this.death_sound=new Audio("death.wav"),this.death_sound.volume=0.5,this.win_sound=new Audio("win.wav"),this.win_sound.volume=0.5}static draw(a,b,c){a.save(),a.translate(b.x,b.y),a.rotate(c),a.beginPath(),a.moveTo(0,-5),a.lineTo(-20,-10),a.lineTo(0,30),a.lineTo(20,-10),a.fill(),a.restore()}get BBox(){return this.game.end?{x:900,y:950,width:250,height:250}:{x:this.pos.x-10,y:this.pos.y-10,width:20,height:20}}click(){if(this.game.end&&(game=new Game(document.getElementById("canvas"))),0<=this.game.lives){game.score=this.game.score,++game.level,game.lives+=this.game.lives;for(var a=0;a<3*this.game.level;a++)game.asteroids.push(new Asteroid(game))}}update(a,b){if(-1!==this.death_start)return void(this.hovering&&(document.body.style.cursor="pointer"));for(let d of this.game.asteroids)if(this.sphereCol(d)&&(d.destroy(),0>this.shield)){this.death_sound.play(),this.game.lives--,this.game.shake(100);for(var c=0;50>c;c++){let e={x:this.pos.x+10*(Math.random()-0.5),y:this.pos.y+10*(Math.random()-0.5)},f={x:10*(Math.random()-0.5),y:10*(Math.random()-0.5)};new Particle(this.game,e,f,{x:20*(Math.random()-0.5),y:20*(Math.random()-0.5)},"#fff",4,2e3)}-1==this.game.lives&&(this.death_start=+new Date,this.destroy(),this.game.gameObjects.push(this)),this.shield=3e3}if(this.cooldown-=b,this.warpCooldown-=b,this.shield-=b,(this.game.pressed.ArrowLeft||this.game.pressed.a)&&(this.rot-=b/200),(this.game.pressed.ArrowRight||this.game.pressed.d)&&(this.rot+=b/200),this.game.pressed.ArrowUp||this.game.pressed.w){this.speed.x-=Math.sin(this.rot)*b/50,this.speed.y+=Math.cos(this.rot)*b/50;let d={x:this.pos.x+10*(Math.random()-0.5),y:this.pos.y+10*(Math.random()-0.5)},e={x:100*Math.sin(this.rot)+20*(Math.random()-0.5)+this.speed.x,y:100*-Math.cos(this.rot)+20*(Math.random()-0.5)+this.speed.y};new Particle(this.game,d,e,{x:5*(Math.random()-0.5),y:5*(Math.random()-0.5)})}if(this.game.pressed[" "]&&0>=this.cooldown){let d={x:70*-Math.sin(this.rot)+this.speed.x,y:70*Math.cos(this.rot)+this.speed.y};new Laser(this.game,this.pos,d,this.rot),this.laser_sound.play();for(var c=0;20>c;c++){let e={x:this.pos.x+10*(Math.random()-0.5),y:this.pos.y+10*(Math.random()-0.5)};new Particle(this.game,e,d,{x:10*(Math.random()-0.5),y:10*(Math.random()-0.5)},"#fff",3,350)}this.game.shake(10),this.speed.x+=20*Math.sin(this.rot),this.speed.y-=20*Math.cos(this.rot),this.cooldown=1e3}this.game.pressed.v&&0>=this.warpCooldown&&(this.pos.x=Math.random()*this.game.canvas.width,this.pos.y=Math.random()*this.game.canvas.height,this.warpCooldown=1e3),this.pos.x+=this.speed.x*b/100,this.pos.y+=this.speed.y*b/100,this.pos.x=(this.game.canvas.width+90+this.pos.x)%(this.game.canvas.width+60)-30,this.pos.y=(this.game.canvas.height+90+this.pos.y)%(this.game.canvas.height+60)-30,a.shadowColor="rgb(255,255,255)",a.shadowBlur=Math.min(1e3,1e3-this.cooldown)/20,a.fillStyle="#fafafa",0<this.shield&&(a.beginPath(),a.lineWidth=Math.pow(this.shield/500,2),a.strokeStyle="#fafafa",a.arc(this.pos.x,this.pos.y,50,0,2*Math.PI),a.stroke()),Ship.draw(a,this.pos,this.rot)}}class Game{constructor(a){this.canvas=a,this.canvas.onmousemove=c=>{this.mouseMove(c)},this.canvas.onmousedown=c=>{this.click(c)},this.pressed={},window.onkeydown=c=>{this.pressed[c.key]=!0},window.onkeyup=c=>{this.pressed[c.key]=!1},this.ctx=canvas.getContext("2d"),this.gameObjects=[],this.toRemove=[],this.lastTime=+new Date,this.gameStart=+new Date,this.mousePos={x:0,y:0},this.shakeMag=0,this.lives=3,this.score=0,this.level=0,this.asteroids=[];for(var b=0;10>b;b++)this.asteroids.push(new Asteroid(this));this.ship=new Ship(this),window.requestAnimationFrame(()=>{this.render()})}get end(){return 0===this.asteroids.length||0>this.lives}add(a){this.gameObjects.push(a)}remove(a){this.toRemove.push(a)}mouseMove(a){let b=this.canvas.getBoundingClientRect(),c=Math.floor((a.clientX-b.left)/this.canvas.offsetWidth*this.canvas.width),d=Math.floor((a.clientY-b.top)/this.canvas.offsetHeight*this.canvas.height);this.mousePos={x:c,y:d}}click(a){this.mouseMove(a);for(let b of this.gameObjects)b.hovering&&b.click()}shake(a){this.shakeMag+=a}render(){let a=this.ctx;document.body.style.cursor="default";let b=+new Date-this.lastTime;this.lastTime=+new Date,this.ctx.save(),this.shakeMag*=0.95,this.ctx.translate(Math.random()*this.shakeMag,Math.random()*this.shakeMag),this.ctx.fillStyle="#212121",this.ctx.fillRect(-200,-200,this.canvas.width+400,this.canvas.height+400);for(let d of this.gameObjects)this.ctx.save(),d.update(this.ctx,b),this.ctx.restore();if(-1!==this.ship.death_start){let d=+new Date-this.ship.death_start;a.fillStyle="#fafafa",a.shadowBlur=50,a.beginPath(),a.arc(this.ship.pos.x,this.ship.pos.y,Math.min(Math.pow(d/20+5,2),1e4),0,2*Math.PI),a.fill(),a.globalAlpha=Math.max(Math.min((d-500)/2e3,1),0),a.textAlign="center",a.fillStyle="#212121",a.font="500px FontAwesome",0>this.lives?a.fillText("\uF00D",1e3,600):a.fillText("\uF091",1e3,600),a.font="200px FontAwesome",0>this.lives?a.fillText("\uF021",1e3,1150):a.fillText("\uF061",1e3,1150),a.globalAlpha=1,a.shadowBlur=0}this.ctx.textAlign="center",this.end||(this.ctx.fillStyle="#fafafa");let c=+new Date-this.gameStart;5e3>=c&&(this.ctx.globalAlpha=Math.pow((5e3-c)/5e3,0.7),this.ctx.font="45px FontAwesome",this.ctx.fillText("\uF062",this.canvas.width/2,this.canvas.height/2-100),this.ctx.fillText("\uF060                 \uF061",this.canvas.width/2,this.canvas.height/2),this.ctx.fillText("\uF05B \uF096",this.canvas.width/2,this.canvas.height/2+120),this.ctx.fillText("\uF047",this.canvas.width/2-23,this.canvas.height/2+170),this.ctx.font="45px cliche",this.ctx.fillText("V",this.canvas.width/2+25,this.canvas.height/2+170),this.ctx.globalAlpha=1);for(let d=0;d<this.lives;d++)Ship.draw(this.ctx,{x:60+60*d,y:70},Math.PI);this.ctx.font="45px FontAwesome";for(let d=0;d<this.level;d++)this.ctx.fillText("\uF061",this.canvas.width-60-60*d,75);this.ctx.font="45px cliche",this.ctx.fillText(this.score,this.canvas.width/2,75),this.ctx.restore();for(let d of this.toRemove)this.gameObjects.splice(this.gameObjects.indexOf(d),1);this.toRemove=[],window.requestAnimationFrame(()=>{this.render()})}}let game=new Game(document.getElementById("canvas"));